---
layout: default
title: North-West Region of Cameroon
---

<h1>North-West Region Investment Budget</h1>
<br>
<div class="alert alert-error">
  This is total values. We'll probably want to do this per-capita if we're going to put it on a map.
</div>
<br>

<script type="text/javascript">
(function ($) {

  window.wdmmg_btmap = {};
  
  var os_path = '/js/openspendingjs';
  var year = '2010';

  yepnope.errorTimeout = 1000;

  yepnope([
   { load: [
    os_path + '/lib/vendor/base64.js',
    os_path + '/lib/boot.js', 
    os_path + '/lib/vendor/accounting.js', 
    os_path + '/lib/utils/utils.js', 
    os_path + '/lib/aggregator.js', 
    os_path + '/lib/vendor/bubbletree/2.0/bubbletree.js',
    os_path + '/lib/vendor/vis4.js',    
    os_path + '/lib/vendor/Tween.js',   
    os_path + '/lib/vendor/jquery.history.js',
    os_path + '/lib/vendor/bubbletree/1.0/bubbletree.css',
    'css/map.css',
    '/img/functions/functions.js'
     ],

     complete: function() {

        $('#preloader .txt').html('loading spending data');

        var $tooltip = $('<div class="tooltip">Tooltip</div>');
        $('.bubbletree').append($tooltip);
        $tooltip.hide();
        
        var formatAmount = BubbleTree.Utils.formatNumber;
    
        function updateLegend(title, colors, limits, currency) {
            var currencyLabel = ' (' + currency + ')';
            var $lg = $('#cm-map-legend');
            $lg.html('');
            $lg.append('<div class="title">Expenditure on '+title+'</div>');
            $.each(colors, function(i,col) {
                var row = $('<div class="row" />'),
                    lbl = formatAmount(limits[i])+'&nbsp;–&nbsp;'+formatAmount(limits[i+1])+
                        (i==0?currencyLabel:'');
                row.append('<div class="color" style="background:'+col+'"></div>');
                row.append('<div class="lbl">'+lbl+'</div>');
                $lg.append(row);
            });
        };
    
        var onNodeClick = function(node) {

            var 
            // create a nice colorscale based on the selected bubble color
            hcl = chroma.hex(node.color).hcl(),         
            colsc = new chroma.ColorScale({
                colors: [
                    chroma.hcl(hcl[0], Math.min(1,hcl[1]), .95),
                    chroma.hcl(hcl[0], Math.min(1.2,hcl[1]), .8),
                    chroma.hcl(hcl[0], Math.min(1.4,hcl[1]), .65),
                    chroma.hcl(hcl[0], Math.min(1.6,hcl[1]), .5),
                    chroma.hcl(hcl[0], Math.min(1.8,hcl[1]), .35),
                    chroma.hcl(hcl[0], Math.min(2,hcl[1]), .2)
                ],
                limits: chroma.limits(node.breakdowns, 'q', 6, 'amount')
            });
            
            // update map legend
            updateLegend(node.label, colsc.colors, colsc.classLimits, 
                         OpenSpending.Utils.currencySymbol(node.currency));
            
            // apply colors to map
            wdmmg_btmap.map.choropleth({
                data: function(e) { 
                    return node.breakdowns[e.departemen];
                },
                colors: function(d) {
                    if (d === undefined || isNaN(d.amount)) return '#ccc';
                    return colsc.getColor(d.amount);
                }
                //,duration: 200
            });
            
            wdmmg_btmap.map.tooltips({ 
                layer: 'departement',
                content: function (e) {
                    var v = node.breakdowns[e];
                    var famount = OpenSpending.Utils.formatAmountWithCommas(v.amount, 0, node.currency)
                    return [e, '<div class="lbl">Expenditure on '+node.label+'</div><div class="amount">'+famount+'</div>']
                },
                delay: 300
            });
            // create tooltips
        };
        
        //$(function() {
            // init bubbletree
            new OpenSpending.Aggregator({
                apiUrl: 'http://openspending.org/api',
                dataset: 'cm-nwr-investments',
                drilldowns: ['cofog1', 'chapter'],
                cuts: ['year:'+year, 'reporting_type:AMOUNT'],
                rootNodeLabel: 'Total Spending ('+year+')', 
                breakdown: 'commune',
                callback: function(data) {
                    //console.log(data);
                    
                    $('#preloader').remove();
                    $('#cm-map').show();

                    wdmmg_btmap.bt = new BubbleTree({
                        data: data,
                        container: '#cm-bubbletree',
                        bubbleType: 'icon',
                        nodeClickCallback: onNodeClick,
                        firstNodeCallback: onNodeClick,
                        rootPath: 'img/functions/',
                        tooltip: {
                            qtip: true,
                            delay: 800,
                            content: function(node) {
                                return [node.label, '<div class="desc">'+(node.description ? node.description : 'No description given')+'</div><div class="amount">£ '+node.famount+'</div>'];
                            }
                        },
                        bubbleStyles: {
                            'cofog1':  BubbleTree.Styles.Cofog1
                        },
                        clearColors: true, // remove all colors coming from OpenSpending API
                    })
                }
            });
             
            // init map
            
            var map = wdmmg_btmap.map = $K.map('#cm-map');
            map.loadStyles('css/map.css', function() {
                map.loadMap('img/north_west_departements.svg', function() {
                    map.addLayer({ 
                        id: 'departement', 
                        key: 'departemen'
                    });
                }); // map.loadMap(function())
            }); // map.loadStyles(function())
            
            $('#cm-map').hide();
        //}); // complete: function() {
    }
   }
  ]); // yepnope()   
})(jQuery)
</script>
    
    
<div id="bt-map">
  <div id="preloader" style="text-align: center; padding: 100px"><img src="img/ajax-loader.gif" style="vertical-align:top" /> &nbsp;<span class="txt">loading javascript libraries</span></div>

  <div id="cm-bt">
    <div class="bubbletree-wrapper">
        <div id="cm-bubbletree" class="bubbletree"></div>
    </div>  
  </div>
  <div id="cm-map-legend"></div>
  <div id="cm-map"></div>
</div><!-- /#cra-map -->
`