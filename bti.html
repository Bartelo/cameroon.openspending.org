---
layout: default
title: Local Council Budget Transparency
---

<h1>Local Council Budget Transparency</h1>
<br><br>

<style>
    #map svg .commune {
        stroke: #ccc;
    }   
</style>

<div class="row">
    <div class="span8">
        <div id="map"></div>
    </div>
    <div class="span4">
        <h3>See how well Councils budget, compare them by:</h3>
        <ul>
            <li>overall score</li>
            <li>% of revenue realized</li>
            <li>% of expenditure realized</li>
            <li>documents produced:
                <ul>
                    <li>...</li>
                </ul>
            </li>
        </ul>
    </div>
</div>

<div class="row">
    <div class="span8 offset2">
        <h3>For each region, on click show:</h3>
        <ul>
            <li>Score</li>
            <li>Key Documents</li>
            <li>% Income / % Expenditure</li>
            <li>Then:<ul>
                <li>Assets (Short-term and Long-term) published</li>
                <li>Aid Transparency</li>
                <li>References to programmes and beneficiaries</li>
                <li>KPI</li>
                <li>Citizen Budgets</li>
                <li>Council say in Budgeting</li>
                <li>Public has a say in Budgeting (PB)</li>
                <li>Time between reporting period & report</li>
                <li>Report after budget</li>
            </ul></li>
        </ul>
    </div>
</div>

<div class="modal hide" id="details-overlay">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">Ã—</button>
        <h3>No title</h3>
    </div>
    <div class="modal-body">
    </div>
</div>

{% raw %}
<script id="details-overlay-content" type="application/handlebars">
    <div>
    RANK {{rank}}
    <ul>
        <li>Budget revenue realization: {{revenue_realized}}</li>
        <li>Budget expenditure realization: {{spending_realized}}</li>
    </ul>
    </div>
</script>
{% endraw %}

<script>
    $(function() {
        $.get('/data/bti.json', function(bti_data) {
            bti_data = JSON.parse(bti_data);

            colscale = new chroma.ColorScale({
                colors: chroma.brewer.PuBu,
                limits: [0,60]
            });

            window.map = $K.map('#map');
            map.loadMap('/img/adamawa.svg', function(map) {

                //map.addLayer('commune', 'glow');
                map.addLayer({
                    id: 'commune',
                    key: 'commune'
                });

                //map.addFilter('oglow', 'glow', { size: 2, color: '#666', strength: 0.6, inner: false });
                //map.getLayer('glow').applyFilter('oglow');

                var colorize = function(d) {
                    if (d.score=='-') return '#ddd';
                    return colscale.getColor(d.score);
                }

                //var colorize = function(d) {
                //    return colscale.getColor(d.revenue_realized_num);
                //}

                map.choropleth({
                    data: function(e) {
                        console.log(e.commune);
                        console.log(e.commune.length);
                        return bti_data[e.commune];
                    },
                    key: 'commune',
                    colors: function(d, pathdata) {
                        if (!d) return '#ddd';
                        return colorize(d)
                    }
                });
                
                map.onLayerEvent('click', function(d) {
                    var data = bti_data[d.commune];
                    var tmpl = Handlebars.compile($("#details-overlay-content").html());
                    var $e = $("#details-overlay");
                    $e.find("h3").html(data.sheet_name);
                    $e.find(".modal-body").html(tmpl(data));
                    $e.modal();
                });
            });
        });
    });
</script>